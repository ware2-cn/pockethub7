'use strict';(function(d){"object"==typeof exports&&"object"==typeof module?d(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],d):d(CodeMirror)})(function(d){var k="template literal msg fallbackmsg let if elseif else switch case default foreach ifempty for call param deltemplate delcall log".split(" ");d.defineMode("soy",function(e){function g(a){return a[a.length-1]}function l(a,b,c){var d=
a.string;if(c=c.exec(d.substr(a.pos)))a.string=d.substr(0,a.pos+c.index);c=a.hideFirstChars(b.indent,function(){return b.localMode.token(a,b.localState)});a.string=d;return c}var h=d.getMode(e,"text/plain"),f={html:d.getMode(e,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:h,text:h,uri:h,css:d.getMode(e,"text/css"),js:d.getMode(e,{name:"text/javascript",statementIndent:2*e.indentUnit})};return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,
localMode:f.html,localState:d.startState(f.html)}},copyState:function(a){return{tag:a.tag,kind:a.kind.concat([]),kindTag:a.kindTag.concat([]),soyState:a.soyState.concat([]),indent:a.indent,localMode:a.localMode,localState:d.copyState(a.localMode,a.localState)}},token:function(a,b){var c;switch(g(b.soyState)){case "comment":return a.match(/^.*?\*\//)?b.soyState.pop():a.skipToEnd(),"comment";case "variable":if(a.match(/^}/))return b.indent-=2*e.indentUnit,b.soyState.pop(),"variable-2";a.next();return null;
case "tag":if(a.match(/^\/?}/))return b.indent="/template"==b.tag||"/deltemplate"==b.tag?0:b.indent-("/}"==a.current()||-1==k.indexOf(b.tag)?2:1)*e.indentUnit,b.soyState.pop(),"keyword";if(a.match(/^([\w?]+)(?==)/))return"kind"==a.current()&&(c=a.match(/^="([^"]+)/,!1))&&(a=c[1],b.kind.push(a),b.kindTag.push(b.tag),b.localMode=f[a]||f.html,b.localState=d.startState(b.localMode)),"attribute";if(a.match(/^"/))return b.soyState.push("string"),"string";a.next();return null;case "literal":return a.match(/^(?=\{\/literal})/)?
(b.indent-=e.indentUnit,b.soyState.pop(),this.token(a,b)):l(a,b,/\{\/literal}/);case "string":return(c=a.match(/^.*?("|\\[\s\S])/))?'"'==c[1]&&b.soyState.pop():a.skipToEnd(),"string"}return a.match(/^\/\*/)?(b.soyState.push("comment"),"comment"):a.match(a.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":a.match(/^\{\$[\w?]*/)?(b.indent+=2*e.indentUnit,b.soyState.push("variable"),"variable-2"):a.match(/^\{literal}/)?(b.indent+=e.indentUnit,b.soyState.push("literal"),"keyword"):(c=a.match(/^\{([\/@\\]?[\w?]*)/))?
("/switch"!=c[1]&&(b.indent+=(/^(\/|(else|elseif|case|default)$)/.test(c[1])&&"switch"!=b.tag?1:2)*e.indentUnit),b.tag=c[1],b.tag=="/"+g(b.kindTag)&&(b.kind.pop(),b.kindTag.pop(),b.localMode=f[g(b.kind)]||f.html,b.localState=d.startState(b.localMode)),b.soyState.push("tag"),"keyword"):l(a,b,/\{|\s+\/\/|\/\*/)},indent:function(a,b){var c=a.indent,f=g(a.soyState);if("comment"==f)return d.Pass;if("literal"==f)/^\{\/literal}/.test(b)&&(c-=e.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(b))return 0;
/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(b)&&(c-=e.indentUnit);"switch"!=a.tag&&/^\{(case|default)\b/.test(b)&&(c-=e.indentUnit);/^\{\/switch\b/.test(b)&&(c-=e.indentUnit)}c&&a.localMode.indent&&(c+=a.localMode.indent(a.localState,b));return c},innerMode:function(a){return a.soyState.length&&"literal"!=g(a.soyState)?null:{state:a.localState,mode:a.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",
blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed");d.registerHelper("hintWords","soy",k.concat("delpackage namespace alias print css debugger".split(" ")));d.defineMIME("text/x-soy","soy")});
