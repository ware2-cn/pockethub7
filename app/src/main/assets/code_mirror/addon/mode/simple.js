'use strict';(function(k){"object"==typeof exports&&"object"==typeof module?k(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],k):k(CodeMirror)})(function(k){function r(e,c){if(!e.hasOwnProperty(c))throw Error("Undefined state "+c+" in simple mode");}function q(e,c){if(!e)return/(?:)/;var d="";e instanceof RegExp?(e.ignoreCase&&(d="i"),e=e.source):e=String(e);return new RegExp((!1===c?"":"^")+"(?:"+e+")",d)}function u(e,c){(e.next||e.push)&&r(c,
e.next||e.push);this.regex=q(e.regex);if(c=e.token)if("string"==typeof c)c=c.replace(/\./g," ");else{for(var d=[],a=0;a<c.length;a++)d.push(c[a]&&c[a].replace(/\./g," "));c=d}else c=null;this.token=c;this.data=e}function v(e,c){return function(d,a){if(a.pending){var b=a.pending.shift();0==a.pending.length&&(a.pending=null);d.pos+=b.text.length;return b.token}if(a.local){if(a.local.end&&d.match(a.local.end))b=a.local.endToken||null,a.local=a.localState=null;else{var b=a.local.mode.token(d,a.localState),
g;a.local.endScan&&(g=a.local.endScan.exec(d.current()))&&(d.pos=d.start+g.index)}return b}for(var h=e[a.state],f=0;f<h.length;f++)if(b=h[f],g=(!b.data.sol||d.sol())&&d.match(b.regex)){b.data.next?a.state=b.data.next:b.data.push?((a.stack||(a.stack=[])).push(a.state),a.state=b.data.push):b.data.pop&&a.stack&&a.stack.length&&(a.state=a.stack.pop());if(b.data.mode){var l=c,h=a,f=b.data.mode,n=b.token,m=void 0;if(f.persistent)for(var p=h.persistentStates;p&&!m;p=p.next)if(f.spec?t(f.spec,p.spec):f.mode==
p.mode)m=p;l=m?m.mode:f.mode||k.getMode(l,f.spec);p=m?m.state:k.startState(l);f.persistent&&!m&&(h.persistentStates={mode:l,spec:f.spec,state:p,next:h.persistentStates});h.localState=p;h.local={mode:l,end:f.end&&q(f.end),endScan:f.end&&!1!==f.forceEnd&&q(f.end,!1),endToken:n&&n.join?n[n.length-1]:n}}b.data.indent&&a.indent.push(d.indentation()+c.indentUnit);b.data.dedent&&a.indent.pop();if(2<g.length){a.pending=[];for(h=2;h<g.length;h++)g[h]&&a.pending.push({text:g[h],token:b.token[h-1]});d.backUp(g[0].length-
(g[1]?g[1].length:0));return b.token[0]}return b.token&&b.token.join?b.token[0]:b.token}d.next();return null}}function t(e,c){if(e===c)return!0;if(!e||"object"!=typeof e||!c||"object"!=typeof c)return!1;var d=0,a;for(a in e)if(e.hasOwnProperty(a)){if(!c.hasOwnProperty(a)||!t(e[a],c[a]))return!1;d++}for(a in c)c.hasOwnProperty(a)&&d--;return 0==d}function w(e,c){return function(d,a,b){if(d.local&&d.local.mode.indent)return d.local.mode.indent(d.localState,a,b);if(!(b=null==d.indent||d.local)&&(b=c.dontIndentStates)){a:{b=
c.dontIndentStates;for(var g=0;g<b.length;g++)if(b[g]===d.state){b=!0;break a}b=void 0}b=-1<b}if(b)return k.Pass;b=d.indent.length-1;g=e[d.state];a:for(;;){for(var h=0;h<g.length;h++){var f=g[h];if(f.data.dedent&&!1!==f.data.dedentIfLineStart){var l=f.regex.exec(a);if(l&&l[0]){b--;if(f.next||f.push)g=e[f.next||f.push];a=a.slice(l[0].length);continue a}}}break}return 0>b?0:d.indent[b]}}k.defineSimpleMode=function(e,c){k.defineMode(e,function(d){return k.simpleMode(d,c)})};k.simpleMode=function(e,c){r(c,
"start");var d={},a=c.meta||{},b=!1,g;for(g in c)if(g!=a&&c.hasOwnProperty(g))for(var h=d[g]=[],f=c[g],l=0;l<f.length;l++){var n=f[l];h.push(new u(n,c));if(n.indent||n.dedent)b=!0}e={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:b?[]:null}},copyState:function(a){var b={state:a.state,pending:a.pending,local:a.local,localState:null,indent:a.indent&&a.indent.slice(0)};a.localState&&(b.localState=k.copyState(a.local.mode,a.localState));a.stack&&(b.stack=a.stack.slice(0));
for(var c=a.persistentStates;c;c=c.next)b.persistentStates={mode:c.mode,spec:c.spec,state:c.state==a.localState?b.localState:k.copyState(c.mode,c.state),next:b.persistentStates};return b},token:v(d,e),innerMode:function(a){return a.local&&{mode:a.local.mode,state:a.localState}},indent:w(d,a)};if(a)for(var m in a)a.hasOwnProperty(m)&&(e[m]=a[m]);return e}});
